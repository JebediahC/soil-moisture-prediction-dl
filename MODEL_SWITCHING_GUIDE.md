# 模型切换使用说明
_document generated by Claude Sonnet4 agent_

## 概述

项目现在支持两种模型：
1. **ConvLSTM**: 原有的卷积LSTM模型
2. **3DCNN-LSTM**: 新添加的3D卷积神经网络+LSTM混合模型

## 3DCNN-LSTM模型特点

### 架构设计
- **3D CNN层**: 用于提取时空特征，能够同时处理时间和空间维度的相关性
- **自适应池化**: 将时间维度压缩到合适的大小，提高计算效率
- **双向LSTM**: 处理时序特征，捕获长期依赖关系
- **批归一化和Dropout**: 提高模型稳定性和泛化能力

### 技术细节
- 使用3个3D卷积层逐步提取特征
- 自适应池化将时间维度从输入长度压缩到8个时间步
- 双向LSTM处理空间展平后的特征
- 输出层重构空间维度并预测未来时间步

## 如何切换模型

### 方法1: 修改配置文件
编辑 `config/config.yaml` 文件：

```yaml
# 使用ConvLSTM模型
model_type: "convlstm"

# 或使用3DCNN-LSTM模型  
model_type: "3dcnn_lstm"
```

### 方法2: 使用命令行工具
```bash
# 切换到ConvLSTM
python model_switch_example.py --switch convlstm

# 切换到3DCNN-LSTM
python model_switch_example.py --switch 3dcnn_lstm

# 查看模型演示
python model_switch_example.py --demo
```

### 方法3: 在代码中直接创建
```python
from src.models import get_model

# 创建ConvLSTM模型
model = get_model('convlstm', input_dim=4)

# 创建3DCNN-LSTM模型
model = get_model('3dcnn_lstm', input_dim=4, hidden_dim=64, lstm_hidden_dim=32)
```

## 训练和模型保存

### 自动命名
训练脚本会根据模型类型自动命名保存的文件：
- ConvLSTM: `convlstm_best_20250722_test-untiled.pth`
- 3DCNN-LSTM: `3dcnn_lstm_best_20250722_test-untiled.pth`

### TensorBoard日志
不同模型的训练日志会保存到不同的目录：
- ConvLSTM: `runs/convlstm_test-untiled/`
- 3DCNN-LSTM: `runs/3dcnn_lstm_test-untiled/`

## 模型性能比较

### ConvLSTM
- **优点**: 参数量小，训练速度快，内存占用低
- **适用场景**: 数据量较小，计算资源有限的情况

### 3DCNN-LSTM  
- **优点**: 能更好地捕获时空特征，理论上预测精度更高
- **缺点**: 参数量大，训练时间长，内存占用高
- **适用场景**: 有充足计算资源，追求更高预测精度的情况

## 使用建议

1. **首次尝试**: 建议先使用ConvLSTM模型进行快速验证
2. **精度提升**: 如果ConvLSTM效果不佳，再尝试3DCNN-LSTM
3. **资源考虑**: 确保有足够的GPU内存来训练3DCNN-LSTM模型
4. **批量大小**: 3DCNN-LSTM可能需要更小的batch_size以适应内存限制

## 故障排除

### 内存不足
如果训练3DCNN-LSTM时出现CUDA内存不足：
1. 减小batch_size
2. 减小模型的hidden_dim参数
3. 使用梯度累积技术

### 模型加载错误
确保加载的权重文件与当前选择的模型类型匹配。不同模型的权重文件不兼容。

## 示例运行

```bash
# 1. 设置使用3DCNN-LSTM模型
python model_switch_example.py --switch 3dcnn_lstm

# 2. 开始训练
python train.py

# 3. 如果需要切换回ConvLSTM
python model_switch_example.py --switch convlstm
python train.py
```
